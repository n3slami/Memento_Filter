# Reproducibility

## Introduction
This document describes how to reproduce the results of the paper *Memento
Filter: A Fast, Dynamic, and Robust Range Filter*.

## Requirements
The following software is required to reproduce the experiments of the paper:

- gcc-11 (or later)
- Boost 1.67.0 (or later)
- Git 2.13 (or later)
- Python 3.7 (or later)
  - Jupyter Notebook 6.0.3 (or later)
  - Matplotlib 3.2.1 (or later)
  - Numpy 1.18.2 (or later)
  - Pandas 1.0.3 (or later)
- Bash 4.4 (or later)
  - realpath 8.28 (or later)
  - wget 1.19.4 (or later)
  - zsdt 0.0.1 (or later)
  - md5sum 8.28 (or later)

We advise to use a Linux machine with at least 32GB of RAM.

## TL;DR
For ease of reproducibility, the `master` branch in the repository contains an
`evaluate.sh` script. This script downloads the required datasets, compiles
Memento filter, sets the benchmarks up, runs them, and plots the results. To
use this script, ensure that the requirements stated in
[reproducibility.md](bench/reproducibility.md) are installed and then run
```bash
git clone https://github.com/n3slami/Memento_Filter.git
cd Memento_Filter
bash evaluate.sh
```
This will reproduce the results in the paper, and may take several days to run
due to the large scale of the experiments. Supplying the `small` option to
script, i.e., executing `bash evaluate.sh small`, runs a shorter and
lower-scale evaluation with 200 times smaller experiments.

This script creates a `paper_results` directory with the datasets and workloads
and places it next to the cloned repository. The generated figures are placed
in `paper_results/figures`, where each is numbered similarly to the paper.


# Reproducing Manually
## Building
To compile the files needed to run the experiments, clone the repository
including all submodules and compile the code:
```bash
git clone --recurse-submodules -j8 https://github.com/n3slami/Memento_Filter.git
cd Memento_Filter
mkdir build && cd build
cmake .. -DCMAKE_BUILD_TYPE=Release
make -j8
```

## Setting the Environment
Create a folder wherever desired (we assume it to be alongside the
`Memento_Filter` path) to contain the artifacts of the experiments and move
into it:
```bash
mkdir ../../paper_results && cd ../../paper_results
```

Then, download the `books_200M_uint64`, `fb_200M_uint64` and
`osm_cellids_200M_uint64` datasets (they will be placed in the `real_datasets`
subfolder) and generate the workloads:
```bash
bash ../Memento_Filter/bench/scripts/download_datasets.sh
bash ../Memento_Filter/bench/scripts/generate_datasets.sh ../Memento_Filter/build real_datasets
```
The generated workloads will be in the `workloads` subfolder.
## Running the Experiments
Now you can execute the tests:
```bash
bash ../Memento_Filter/bench/scripts/execute_tests.sh ../Memento_Filter/build workloads
```
The results will be in the `results` subfolder.

Note that the experiments will take a long time to complete.

Finally, to generate the figures, run the
`Memento_Filter/bench/scripts/plot.py` script. The figures will be saved in the
`figures` subfolder as pdf files.

At the end of the process, the `paper_results` folder will have the following
structure:
- `real_datasets`: contains the original `books_200M_uint64, fb_200M_uint64`
  and `osm_cellids_200M_uint64` datasets
- `workloads`: contains the generated datasets and workloads for each test
- `results`: contains the results of the experiments in csv format
- `figures`: contains the figures of the paper

## Figures and Tables

The following results of the paper are generated by the `plot.py` script in the
`paper_results/figures` folder: 
- Fig. 8. `corr_test_(Fig_8).pdf`
- Fig. 9. `fpr_test_all_(Fig_9).pdf` and its accopanying table `table_(Fig_9).tex`
- Fig. 10. `true_queries_test_(Fig_10).pdf`
- Fig. 11. `constr_time_test_(Fig_11).pdf`
- Fig. 11. `vary_memento_test_(Fig_12).pdf`

## Expandability Results
To manually generate the figures pertaining to the expandable Memento filter,
repeat the instructions above after switching to the `expandable` branch. The
following figures will then be generated by `plot.py` and placed in the
`paper_resutls/figures` directory:
- Fig. 12. `expansion_test_(Fig_13).pdf`
- Fig. 12. `b_tree_test_(Fig_14).pdf`

